<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Admin</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            padding: 20px;
        }

        .admin-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .admin-header h1 {
            color: #e86a33;
        }

        .logout-btn {
            background: #dc3545;
        }

        .logout-btn:hover {
            background: #c82333;
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <div id="login-screen">
            <div style="max-width: 400px; margin: 60px auto; text-align: center;">
                <h2>Admin Access</h2>
                <input id="login-password" type="password" placeholder="Enter password"
                    style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 12px; font-size: 1rem;">
                <button id="login-btn"
                    style="width: 100%; padding: 12px; font-size: 1rem; margin-bottom: 8px;">Login</button>
                <button id="forgot-password-btn"
                    style="width: 100%; padding: 12px; font-size: 0.95rem; background: #6c757d;">Forgot
                    Password?</button>
            </div>
        </div>

        <div id="admin-screen" hidden>
            <div class="admin-header">
                <h1>Quiz Admin Panel</h1>
                <button id="logout-btn" class="logout-btn">Logout</button>
            </div>

            <div class="admin-panel" style="margin-top: 0; border-radius: 0;">
                <h3>Question Editor</h3>
                <label>Question
                    <textarea id="admin-question" rows="2"></textarea>
                </label>
                <label>Category
                    <input id="admin-category" type="text" placeholder="e.g. Geography">
                </label>
                <div class="admin-answers">
                    <div class="admin-answer-row">
                        <input type="radio" name="admin-correct" value="0" checked>
                        <input type="text" id="admin-ans-0" placeholder="Answer 1">
                    </div>
                    <div class="admin-answer-row">
                        <input type="radio" name="admin-correct" value="1">
                        <input type="text" id="admin-ans-1" placeholder="Answer 2">
                    </div>
                    <div class="admin-answer-row">
                        <input type="radio" name="admin-correct" value="2">
                        <input type="text" id="admin-ans-2" placeholder="Answer 3">
                    </div>
                    <div class="admin-answer-row">
                        <input type="radio" name="admin-correct" value="3">
                        <input type="text" id="admin-ans-3" placeholder="Answer 4">
                    </div>
                </div>
                <div class="admin-actions">
                    <button id="add-question-btn">Add Question</button>
                </div>
                <hr>
                <h4>Existing Questions</h4>
                <ul id="question-list" class="question-list"></ul>
                <div class="admin-remove">
                    <input id="admin-remove-category" type="text" placeholder="Category to remove">
                    <button id="remove-by-category-btn">Remove By Category</button>
                </div>
                <hr>
                <h4>Security</h4>
                <div style="padding: 12px; background: #f8f0e5; border-radius: 6px;">
                    <div
                        style="margin-bottom: 12px; padding: 10px; background: #fff; border-left: 4px solid #e86a33; border-radius: 3px;">
                        <strong>Current Security Question:</strong><br>
                        <div id="current-security-question" style="margin-top: 6px; font-style: italic;"></div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label>Current Password
                            <input id="current-password" type="password"
                                style="width: 100%; padding: 8px; margin-top: 4px;">
                        </label>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label>New Password
                            <input id="new-password" type="password"
                                style="width: 100%; padding: 8px; margin-top: 4px;">
                        </label>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label>New Security Question (optional - leave blank to keep current)
                            <input id="security-question" type="text" placeholder="e.g., What is your pet's name?"
                                style="width: 100%; padding: 8px; margin-top: 4px;">
                        </label>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label>New Security Answer (optional - leave blank to keep current)
                            <input id="security-answer" type="password" placeholder="Answer"
                                style="width: 100%; padding: 8px; margin-top: 4px;">
                        </label>
                    </div>
                    <button id="change-password-btn" style="width: 100%; padding: 10px; margin-bottom: 8px;">Change
                        Password</button>
                </div>
                <hr>
                <p style="text-align: center; margin-top: 20px;"><a href="index.html">Back to Quiz</a></p>
            </div>
        </div>
    </div>

    <script>
        // Shared data and functions with main quiz
        const DEFAULT_PASSWORD = 'admin';
        const STORAGE_KEY_PASSWORD = 'quizAdminPassword';
        const STORAGE_KEY_SECURITY_Q = 'quizSecurityQuestion';
        const STORAGE_KEY_SECURITY_A = 'quizSecurityAnswer';
        const STORAGE_KEY = 'quizQuestions';

        // Load password and security info from localStorage
        let currentPassword = localStorage.getItem(STORAGE_KEY_PASSWORD) || DEFAULT_PASSWORD;
        let securityQuestion = localStorage.getItem(STORAGE_KEY_SECURITY_Q) || 'What is your pet\'s name?';
        let securityAnswer = localStorage.getItem(STORAGE_KEY_SECURITY_A) || 'default';

        // Load questions from localStorage or use defaults
        let quizQuestions = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
            {
                question: "what is the capital of france ?",
                category: "Geography",
                answers: [
                    { text: "London", correct: false },
                    { text: "Berlin", correct: false },
                    { text: "Paris", correct: true },
                    { text: "Madrid", correct: false },
                ],
            },
            {
                question: "Which planet is known as the red planet?",
                category: "Science",
                answers: [
                    { text: "Mars", correct: true },
                    { text: "Jupiter", correct: false },
                    { text: "Saturn", correct: false },
                    { text: "Neptune", correct: false },
                ],
            },
            {
                question: "What is the name of the largest ocean on Earth ?",
                category: "Geography",
                answers: [
                    { text: "Pacific ocean", correct: true },
                    { text: "Atlantic ocean", correct: false },
                    { text: "Indian ocean", correct: false },
                    { text: "Arctic ocean", correct: false },
                ],
            },
            {
                question: "Which programming language is the easiest to learn ?",
                category: "Programming",
                answers: [
                    { text: "C++", correct: false },
                    { text: "Javascript", correct: false },
                    { text: "Python", correct: true },
                    { text: "C", correct: false },
                ],
            },
            {
                question: "What is the capital of Japan?",
                category: "Geography",
                answers: [
                    { text: "Osaka", correct: false },
                    { text: "Tokyo", correct: true },
                    { text: "Kyoto", correct: false },
                    { text: "Hiroshima", correct: false },
                ],
            },
            {
                question: "Who painted the Mona Lisa?",
                category: "Art & History",
                answers: [
                    { text: "Van Gogh", correct: false },
                    { text: "Leonardo da Vinci", correct: true },
                    { text: "Michelangelo", correct: false },
                    { text: "Raphael", correct: false },
                ],
            },
            {
                question: "What is the chemical symbol for gold?",
                category: "Science",
                answers: [
                    { text: "Go", correct: false },
                    { text: "Gd", correct: false },
                    { text: "Au", correct: true },
                    { text: "Ag", correct: false },
                ],
            },
            {
                question: "In which year did the Titanic sink?",
                category: "Art & History",
                answers: [
                    { text: "1912", correct: true },
                    { text: "1905", correct: false },
                    { text: "1920", correct: false },
                    { text: "1898", correct: false },
                ],
            },
            {
                question: "What does HTML stand for?",
                category: "Programming",
                answers: [
                    { text: "Hyper Text Markup Language", correct: true },
                    { text: "High Tech Modern Language", correct: false },
                    { text: "Home Tool Markup Language", correct: false },
                    { text: "Hyperlinks and Text Markup Language", correct: false },
                ],
            },
            {
                question: "What is the smallest country in the world?",
                category: "Geography",
                answers: [
                    { text: "Monaco", correct: false },
                    { text: "San Marino", correct: false },
                    { text: "Vatican City", correct: true },
                    { text: "Liechtenstein", correct: false },
                ],
            },
            {
                question: "How many bones are in the human body?",
                category: "Science",
                answers: [
                    { text: "186", correct: false },
                    { text: "206", correct: true },
                    { text: "226", correct: false },
                    { text: "196", correct: false },
                ],
            },
            {
                question: "What is the capital of Australia?",
                category: "Geography",
                answers: [
                    { text: "Sydney", correct: false },
                    { text: "Melbourne", correct: false },
                    { text: "Canberra", correct: true },
                    { text: "Brisbane", correct: false },
                ],
            },
            {
                question: "Who wrote 'Romeo and Juliet'?",
                category: "Art & History",
                answers: [
                    { text: "Jane Austen", correct: false },
                    { text: "William Shakespeare", correct: true },
                    { text: "Charles Dickens", correct: false },
                    { text: "Mark Twain", correct: false },
                ],
            },
            {
                question: "What is the speed of light in vacuum?",
                category: "Science",
                answers: [
                    { text: "300,000 km/s", correct: true },
                    { text: "150,000 km/s", correct: false },
                    { text: "450,000 km/s", correct: false },
                    { text: "200,000 km/s", correct: false },
                ],
            },
            {
                question: "Which country is home to the Eiffel Tower?",
                category: "Geography",
                answers: [
                    { text: "Germany", correct: false },
                    { text: "France", correct: true },
                    { text: "Belgium", correct: false },
                    { text: "Italy", correct: false },
                ],
            },
            {
                question: "What is the primary purpose of CSS in web development?",
                category: "Programming",
                answers: [
                    { text: "Adding interactivity", correct: false },
                    { text: "Storing data", correct: false },
                    { text: "Styling and layout", correct: true },
                    { text: "Server management", correct: false },
                ],
            },
        ];

        const loginScreen = document.getElementById('login-screen');
        const adminScreen = document.getElementById('admin-screen');
        const loginPassword = document.getElementById('login-password');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const adminQuestion = document.getElementById('admin-question');
        const adminCategory = document.getElementById('admin-category');
        const adminAns = [
            document.getElementById('admin-ans-0'),
            document.getElementById('admin-ans-1'),
            document.getElementById('admin-ans-2'),
            document.getElementById('admin-ans-3')
        ];
        const addQuestionBtn = document.getElementById('add-question-btn');
        const questionList = document.getElementById('question-list');
        const removeByCategoryInput = document.getElementById('admin-remove-category');
        const removeByCategoryBtn = document.getElementById('remove-by-category-btn');
        const changePasswordBtn = document.getElementById('change-password-btn');
        const currentPasswordInput = document.getElementById('current-password');
        const newPasswordInput = document.getElementById('new-password');
        const securityQuestionInput = document.getElementById('security-question');
        const securityAnswerInput = document.getElementById('security-answer');
        const forgotPasswordBtn = document.getElementById('forgot-password-btn');
        const currentSecurityQuestionDisplay = document.getElementById('current-security-question');

        function updateSecurityQuestionDisplay() {
            if (currentSecurityQuestionDisplay) {
                currentSecurityQuestionDisplay.textContent = securityQuestion || '(none set)';
            }
        }

        loginBtn.addEventListener('click', () => {
            if (loginPassword.value === currentPassword) {
                loginScreen.hidden = true;
                adminScreen.hidden = false;
                renderQuestionList();
                updateSecurityQuestionDisplay();
                loginPassword.value = '';
                // Clear security fields on login - don't pre-populate to avoid confusion
                securityAnswerInput.value = '';
                securityQuestionInput.value = '';
                // Clear password fields too
                currentPasswordInput.value = '';
                newPasswordInput.value = '';
            } else {
                alert('Incorrect password');
                loginPassword.value = '';
                loginPassword.focus();
            }
        });

        loginPassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loginBtn.click();
        });

        logoutBtn.addEventListener('click', () => {
            adminScreen.hidden = true;
            loginScreen.hidden = false;
            loginPassword.focus();
        });

        forgotPasswordBtn.addEventListener('click', () => {
            // Only ask the security question, not the answer
            const answer = prompt(securityQuestion + '\n\nAnswer:');
            if (answer === null) return; // User cancelled
            // Check answer securely (never display the correct answer)
            if (answer.trim().toLowerCase() === securityAnswer.toLowerCase()) {
                const newPass = prompt('Enter your new password (minimum 4 characters):');
                if (newPass === null) return;
                if (newPass.trim().length < 4) {
                    alert('Password must be at least 4 characters');
                    return;
                }
                currentPassword = newPass.trim();
                localStorage.setItem(STORAGE_KEY_PASSWORD, currentPassword);
                loginScreen.hidden = false;
                adminScreen.hidden = true;
                loginPassword.value = '';
                loginPassword.focus();
                alert('Password reset successfully!');
            } else {
                alert('Incorrect security answer');
            }
        });

        changePasswordBtn.addEventListener('click', () => {
            const curr = currentPasswordInput.value.trim();
            const newPass = newPasswordInput.value.trim();
            const secQ = securityQuestionInput.value.trim();
            const secA = securityAnswerInput.value.trim();
            if (!curr || !newPass) {
                alert('Please fill in password fields');
                return;
            }
            if (curr !== currentPassword) {
                alert('Current password is incorrect');
                currentPasswordInput.value = '';
                return;
            }
            if (newPass.length < 4) {
                alert('New password must be at least 4 characters');
                return;
            }
            // Allow optional security info updates (if provided)
            if ((secQ && !secA) || (!secQ && secA)) {
                alert('Please provide both a security question AND answer, or leave both blank to keep current settings');
                return;
            }
            currentPassword = newPass;
            if (secQ && secA) {
                securityQuestion = secQ;
                securityAnswer = secA;
                localStorage.setItem(STORAGE_KEY_SECURITY_Q, secQ);
                localStorage.setItem(STORAGE_KEY_SECURITY_A, secA);
            }
            localStorage.setItem(STORAGE_KEY_PASSWORD, newPass);
            alert('Password' + (secQ ? ' and security info' : '') + ' updated successfully');
            currentPasswordInput.value = '';
            newPasswordInput.value = '';
            securityQuestionInput.value = '';
            securityAnswerInput.value = '';
            // Refresh the display of current security question
            updateSecurityQuestionDisplay();
        });

        function addQuestion(questionObj) {
            if (!questionObj || !questionObj.question) return { ok: false, reason: 'invalid' };
            const normalized = questionObj.question.trim().toLowerCase();
            const duplicate = quizQuestions.some(q => (q.question || '').trim().toLowerCase() === normalized);
            if (duplicate) return { ok: false, reason: 'duplicate' };
            quizQuestions.push(questionObj);
            saveQuestions();
            return { ok: true };
        }

        function removeQuestion(index) {
            if (typeof index !== 'number' || index < 0 || index >= quizQuestions.length) return false;
            quizQuestions.splice(index, 1);
            saveQuestions();
            return true;
        }

        function removeQuestionsByCategory(cat) {
            if (!cat) return 0;
            let removed = 0;
            for (let i = quizQuestions.length - 1; i >= 0; i--) {
                if (quizQuestions[i].category === cat) {
                    quizQuestions.splice(i, 1);
                    removed++;
                }
            }
            if (removed) saveQuestions();
            return removed;
        }

        function saveQuestions() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(quizQuestions));
            } catch (e) { }
        }

        function renderQuestionList() {
            questionList.innerHTML = '';
            quizQuestions.forEach((q, i) => {
                const li = document.createElement('li');
                const text = document.createElement('span');
                text.textContent = `${i}: ${q.question} [${q.category}]`;
                const btn = document.createElement('button');
                btn.textContent = 'Remove';
                btn.addEventListener('click', () => {
                    if (confirm(`Remove: "${q.question}"?`)) {
                        removeQuestion(i);
                        renderQuestionList();
                    }
                });
                li.appendChild(text);
                li.appendChild(btn);
                questionList.appendChild(li);
            });
        }

        if (addQuestionBtn) {
            addQuestionBtn.addEventListener('click', () => {
                const qText = (adminQuestion.value || '').trim();
                const cat = (adminCategory.value || '').trim() || 'Uncategorized';
                if (!qText) {
                    alert('Please enter a question');
                    return;
                }
                const answers = adminAns.map((el) => ({ text: (el.value || '').trim(), correct: false }));
                const correctRadio = document.querySelector('input[name="admin-correct"]:checked');
                const correctIndex = correctRadio ? Number(correctRadio.value) : 0;
                if (!answers.some(a => a.text)) {
                    alert('Please provide at least one answer');
                    return;
                }
                if (answers[correctIndex]) answers[correctIndex].correct = true;
                const questionObj = { question: qText, category: cat, answers };
                const res = addQuestion(questionObj);
                if (res && res.ok) {
                    adminQuestion.value = '';
                    adminCategory.value = '';
                    adminAns.forEach(a => a.value = '');
                    renderQuestionList();
                    alert('Question added');
                } else if (res && res.reason === 'duplicate') {
                    alert('Duplicate question detected â€” not added.');
                } else {
                    alert('Failed to add question');
                }
            });
        }

        if (removeByCategoryBtn) {
            removeByCategoryBtn.addEventListener('click', () => {
                const cat = (removeByCategoryInput.value || '').trim();
                if (!cat) {
                    alert('Enter a category to remove');
                    return;
                }
                if (!confirm(`Remove all ${cat} questions?`)) return;
                const removed = removeQuestionsByCategory(cat);
                renderQuestionList();
                removeByCategoryInput.value = '';
                alert(`Removed ${removed} question(s) from category "${cat}"`);
            });
        }
    </script>
</body>

</html>